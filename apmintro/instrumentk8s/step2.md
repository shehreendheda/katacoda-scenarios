The `store-frontend` service has a Ruby-on-Rails framework. Instrumentation is done in two places: the files that are used to build the image for the service and the daemonset configuration file. 

The store-frontend service has been instrumented for you. Let's go through the instrumentation. 

1. Click `app-files/store-frontend/Gemfile`{{open}} to view the Gemfile for the store-frontend. The Gemfile installs the required tracing and log collection libraries.<p> **Line 46** installs the `ddtrace` Gem, which is <a href="https://docs.datadoghq.com/tracing/setup/ruby/" target="_blank">Datadogâ€™s tracing client for Ruby</a>. The `ddtrace` library traces requests as they flow across web servers, databases, and microservices so that developers have high visibility into bottlenecks and troublesome requests. <p>**Line 48** installs the `logging-rails` Gem, which is a railtie for integrating the Ruby logging framework into the Rails application. To learn more, view the <a href="https://github.com/TwP/logging-rails" target="_blank">logging-rails</a> documentation. <p>**Line 49** installs the `lograge` Gem to send logs to Datadog. To learn more, view the <a href="https://docs.datadoghq.com/logs/log_collection/ruby/#setup" target="_blank">Ruby on Rails log collection</a> documentation.

2. Click `app-files/store-frontend/config/initializers/datadog.rb`{{open}} to view the initializer file that enables Rails instrumentation. <p>**Line 3** activates autoinstrumentation for Rails, enabling automatic trace collection from the service. You can view the definitions of each option in the <a href="https://docs.datadoghq.com/tracing/setup/ruby/#rails" target="_blank">Tracing Ruby Applications - Integration Instrumentation - Rails</a> documentation. <p>**Line 5** makes sure requests are also instrumented. You can view the definitions of each option in the <a href="https://docs.datadoghq.com/tracing/setup/ruby/#net-http" target="_blank">Tracing Ruby Applications - Integration Instrumentation - Net/HTTP</a> documentation. <p>**Line 6** allows you to update the default behavior of the Datadog tracer. You can view the definitions of each option in the <a href="https://docs.datadoghq.com/tracing/setup/ruby/#advanced-configuration" target="_blank">Tracing Ruby Applications - Advanced Configuration - Tracer Settings</a> documentation.

3. Click `app-files/store-frontend/config/environments/development.rb`{{open}} to view the configuration file that converts the logs to the JSON format using **Lines 11-28**. To learn more, view the <a href="https://docs.datadoghq.com/tracing/connect_logs_and_traces/ruby/?tab=lograge#automatic-trace-id-injection" target="_blank">Connecting Ruby Logs and Traces</a> documentation. <p> With the service instrumented and trace collection automatically enabled via the datadog.rb initializer file, you can finish enabling log collection and App Analytics for the service. <p> After instrumenting the app, the configuration file for the kubernetes

4. Click `k8s-manifests/ecommerce-app/frontend.yaml`{{open}} to view the daemonset configuration file for the store-frontend service. The following lines are relevant to trace and log collection. <p> **Line 38** - The `DD_AGENT_HOST` environment variable configures your application pods to pull the host IP in order to communicate with the Datadog Agent. To learn more, view the <a href="https://docs.datadoghq.com/agent/kubernetes/apm/?tab=daemonset#setup" target="_blank">Kubernetes Trace Collection</a> documentation. <p> **Line 42** - `DD_LOGS_INJECTION=true` enables automatic injection of trace IDs into the logs from the supported logging libraries to correlate traces and logs. <p> **Line 44** - `DD_ANALYTICS_ENABLED=true` enables App Analytics for the traces. <p> **Line 46** - This image is used to build the store-frontend service. The image was built using the files in ``app-files/store-frontend`.
 